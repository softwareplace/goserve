{{range .}}{{$opid := .OperationId}}
{{range .TypeDefinitions}}
// {{.TypeName}} defines parameters for {{$opid}}.
type {{.TypeName}} {{if .IsAlias}}={{end}} {{.Schema.TypeDecl}}
{{end}}
{{end}}

{{range .}}{{$entry := .}}
{{$opid := $entry.OperationId}}
func (rh *resourceHandlerImpl[T]){{$opid}}(ctx *goservecontext.Request[T]) {
    {{$opid := .OperationId}}
    {{ $processed := false -}}
    {{$hasParams := or .PathParams .QueryParams .HeaderParams}}
    {{$hasBody := gt (len .Bodies) 0}}
    {{range .Bodies}}
    {{if and (not $processed) .IsSupported -}}
    {{$contentType := .ContentType -}}
        goserveerrohandler.Handler(func() {
            requestBody := {{.Schema.TypeDecl}}{}
            request.GetRequestBody(ctx, requestBody, func(ctx *goservecontext.Request[T], body {{.Schema.TypeDecl}}) {
            clientRequest := {{$entry.OperationId}}ClientRequest{
                                    Body: body,
                                }
            {{if or $hasParams }}err := ctx.BindRequestParams(&clientRequest)
                contentType := ctx.Request.Header.Get(goservecontext.ContentType)
                if err == nil && strings.Contains(contentType, goservecontext.MultipartFormData) {
                    _ = goservereflect.ParamsExtract(&body,
                        goservereflect.ParamsExtractorSource{
                            Tree: ctx.FormValues(),
                        },
                    )
                }
                if err != nil {
                    log.Errorf("Failed to bind {{$entry.OperationId}}ClientRequest request params: %+v", err)
                    ctx.Error(err.Error(), err.Code)
                    return
                }
            {{ end }}
            rh.Service.{{$entry.OperationId}}(clientRequest, ctx)
            }, func(ctx *goservecontext.Request[T], err error) {
            ctx.InternalServerError("Internal server error")
            })
        }, func(err error) {
            log.Errorf("[{{$entry.Method}} {{$entry.Path}}]:: {{$opid}} result with error: %+v", err)
            ctx.InternalServerError("Internal server error")
        })
        {{ $processed = true -}}
        {{end}}
        {{end}}
        {{if not $processed -}}
        goserveerrohandler.Handler(func() {
            {{if or $hasParams }}
            clientRequest := {{$entry.OperationId}}ClientRequest{
            }
            err := ctx.BindRequestParams(&clientRequest)
                if err != nil {
                    log.Errorf("Failed to bind {{$entry.OperationId}}ClientRequest request params: %+v", err)
                    ctx.Error(err.Error(), err.Code)
                    return
                }
                rh.Service.{{$entry.OperationId}}(clientRequest, ctx)
                {{ else }}
                rh.Service.{{$entry.OperationId}}(ctx)
            {{ end }}

        }, func(err error) {
            log.Errorf("[{{.Method}} {{.Path}}]:: {{$opid}} result with error: %+v", err)
            ctx.InternalServerError("Internal server error")
        })
        {{end}}
        }
{{end}}
